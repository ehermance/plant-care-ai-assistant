{% extends "base.html" %}

{% block title %}Care Calendar - {{ month_name }} {{ year }} - PlantCareAI{% endblock %}

{% block content %}
<section class="page-header">
  <h1 class="page-title">Care Calendar</h1>
  <p class="page-subtitle">Track all your plant care activities at a glance</p>
  <div class="page-actions">
    <a href="{{ url_for('reminders.index') }}" class="btn btn-secondary">
      â† All Reminders
    </a>
    <a href="{{ url_for('reminders.create') }}" class="btn btn-primary">
      + New Reminder
    </a>
  </div>
</section>

<!-- Calendar Navigation -->
<div class="calendar-nav">
  <a href="{{ url_for('reminders.calendar', year=prev_year, month=prev_month) }}" class="btn btn-secondary">
    â† Previous
  </a>
  <h2 class="calendar-month-title">{{ month_name }} {{ year }}</h2>
  <a href="{{ url_for('reminders.calendar', year=next_year, month=next_month) }}" class="btn btn-secondary">
    Next â†’
  </a>
</div>

<!-- Calendar Grid -->
<div class="calendar-wrapper">
  <table class="calendar-grid" role="grid" aria-label="Care calendar for {{ month_name }} {{ year }}">
    <thead>
      <tr>
        <th scope="col" abbr="Monday">Mon</th>
        <th scope="col" abbr="Tuesday">Tue</th>
        <th scope="col" abbr="Wednesday">Wed</th>
        <th scope="col" abbr="Thursday">Thu</th>
        <th scope="col" abbr="Friday">Fri</th>
        <th scope="col" abbr="Saturday">Sat</th>
        <th scope="col" abbr="Sunday">Sun</th>
      </tr>
    </thead>
    <tbody>
      {% for week in calendar_grid %}
      <tr>
        {% for day in week %}
        <td class="calendar-day {% if day == 0 %}calendar-day-empty{% elif '%04d-%02d-%02d'|format(year, month, day) == today|string %}calendar-day-today{% endif %}{% if day != 0 and reminders_by_date.get('%04d-%02d-%02d'|format(year, month, day)) %} calendar-day-has-reminders{% endif %}">
          {% if day != 0 %}
            <div class="calendar-day-header">
              <span class="calendar-day-number">{{ day }}</span>
            </div>

            {% set date_key = '%04d-%02d-%02d'|format(year, month, day) %}
            {% set day_reminders = reminders_by_date.get(date_key, []) %}

            {% if day_reminders %}
            <div class="calendar-day-reminders">
              {% for reminder in day_reminders[:3] %}
              <div class="calendar-reminder calendar-reminder-{{ reminder.reminder_type }}">
                <a href="{{ url_for('reminders.view', reminder_id=reminder.id) }}" class="calendar-reminder-link">
                  <span class="calendar-reminder-icon" aria-hidden="true">
                    {% if reminder.reminder_type == 'watering' %}ğŸ’§
                    {% elif reminder.reminder_type == 'fertilizing' %}ğŸŒ¿
                    {% elif reminder.reminder_type == 'misting' %}ğŸ’¦
                    {% elif reminder.reminder_type == 'pruning' %}âœ‚ï¸
                    {% elif reminder.reminder_type == 'repotting' %}ğŸª´
                    {% elif reminder.reminder_type == 'inspection' %}ğŸ”
                    {% else %}ğŸ“
                    {% endif %}
                  </span>
                  <span class="calendar-reminder-title">
                    {{ reminder.plants.name if reminder.plants else 'Plant' }}
                  </span>
                </a>
              </div>
              {% endfor %}

              {% if day_reminders|length > 3 %}
              <div class="calendar-reminder-more">
                +{{ day_reminders|length - 3 }} more
              </div>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Legend -->
<div class="calendar-legend card">
  <h3 class="section-title">Reminder Types</h3>
  <div class="calendar-legend-items">
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸ’§</span>
      <span>Watering</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸŒ¿</span>
      <span>Fertilizing</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸ’¦</span>
      <span>Misting</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">âœ‚ï¸</span>
      <span>Pruning</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸª´</span>
      <span>Repotting</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸ”</span>
      <span>Inspection</span>
    </div>
    <div class="calendar-legend-item">
      <span class="calendar-legend-icon" aria-hidden="true">ğŸ“</span>
      <span>Custom</span>
    </div>
  </div>
</div>

{% endblock %}
