{% extends "base.html" %}

{% block title %}Care Calendar - {{ month_name }} {{ year }} - Plant Care AI Assistant - PlantCareAI{% endblock %}
{% block description %}Track all your plant care activities at a glance.{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
  <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 dark:text-slate-100 mb-2">
    Care Calendar <span class="inline-block" aria-hidden="true">ğŸ“…</span>
  </h1>
  <p class="text-lg text-slate-600 dark:text-slate-400">
    Track all your plant care activities at a glance
  </p>
</div>

<!-- Action Buttons -->
<div class="flex flex-wrap gap-3 mb-8">
  <a href="{{ url_for('reminders.index') }}" class="btn btn-secondary">
    <span aria-hidden="true">â†</span> All Reminders
  </a>
  <a href="{{ url_for('reminders.create') }}" class="btn btn-primary">
    <span aria-hidden="true">+</span> New Reminder
  </a>
</div>

<!-- Calendar Navigation -->
<div class="card mb-6">
  <div class="flex items-center justify-between">
    <a href="{{ url_for('reminders.calendar', year=prev_year, month=prev_month) }}" class="btn btn-secondary">
      <span aria-hidden="true">â†</span> Previous
    </a>
    <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100">{{ month_name }} {{ year }}</h2>
    <a href="{{ url_for('reminders.calendar', year=next_year, month=next_month) }}" class="btn btn-secondary">
      Next <span aria-hidden="true">â†’</span>
    </a>
  </div>
</div>

<!-- Calendar Grid -->
<div class="card mb-6 overflow-x-auto">
  <table class="w-full table-fixed border-collapse" role="grid" aria-label="Care calendar for {{ month_name }} {{ year }}">
    <thead>
      <tr class="border-b-2 border-slate-200 dark:border-slate-700">
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Monday">Mon</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Tuesday">Tue</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Wednesday">Wed</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Thursday">Thu</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Friday">Fri</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Saturday">Sat</th>
        <th scope="col" class="w-1/7 p-3 text-sm font-semibold text-slate-700 dark:text-slate-300 text-center" abbr="Sunday">Sun</th>
      </tr>
    </thead>
    <tbody>
      {% for week in calendar_grid %}
      <tr class="border-b border-slate-200 dark:border-slate-700">
        {% for day in week %}
        {% set date_key = '%04d-%02d-%02d'|format(year, month, day) %}
        {% set day_reminders = reminders_by_date.get(date_key, []) %}
        {% set is_today = date_key == today|string %}

        <td class="w-1/7 align-top p-2 min-h-[120px] {% if day == 0 %}bg-slate-50 dark:bg-slate-900{% elif is_today %}bg-emerald-50 dark:bg-emerald-900/20{% else %}bg-white dark:bg-slate-800{% endif %} border border-slate-200 dark:border-slate-700 transition-colors">
          {% if day != 0 %}
            <div class="mb-2">
              <span class="inline-flex items-center justify-center w-7 h-7 text-sm font-semibold rounded-full {% if is_today %}bg-emerald-600 text-white dark:bg-emerald-500{% else %}text-slate-700 dark:text-slate-300{% endif %}">
                {{ day }}
              </span>
            </div>

            {% if day_reminders %}
            <div class="space-y-1">
              {% for reminder in day_reminders[:3] %}
              <div class="text-xs rounded-lg px-2 py-1 bg-slate-100 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 hover:border-emerald-500 dark:hover:border-emerald-400 transition-colors">
                <a href="{{ url_for('reminders.view', reminder_id=reminder.id) }}" class="flex items-center gap-1 text-slate-900 dark:text-slate-100 hover:text-emerald-600 dark:hover:text-emerald-400">
                  <span aria-hidden="true">
                    {% if reminder.reminder_type == 'watering' %}ğŸ’§
                    {% elif reminder.reminder_type == 'fertilizing' %}ğŸŒ¿
                    {% elif reminder.reminder_type == 'misting' %}ğŸ’¦
                    {% elif reminder.reminder_type == 'pruning' %}âœ‚ï¸
                    {% elif reminder.reminder_type == 'repotting' %}ğŸª´
                    {% elif reminder.reminder_type == 'inspection' %}ğŸ”
                    {% else %}ğŸ“
                    {% endif %}
                  </span>
                  <span class="truncate">
                    {{ reminder.plants.name if reminder.plants else 'Plant' }}
                  </span>
                </a>
              </div>
              {% endfor %}

              {% if day_reminders|length > 3 %}
              <div class="text-xs text-slate-500 dark:text-slate-400 pl-2">
                +{{ day_reminders|length - 3 }} more
              </div>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Legend -->
<div class="card">
  <h3 class="section-title">Reminder Types</h3>
  <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4">
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸ’§</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Watering</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸŒ¿</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Fertilizing</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸ’¦</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Misting</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">âœ‚ï¸</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Pruning</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸª´</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Repotting</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸ”</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Inspection</span>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-2xl" aria-hidden="true">ğŸ“</span>
      <span class="text-sm text-slate-700 dark:text-slate-300">Custom</span>
    </div>
  </div>
</div>

{% endblock %}
