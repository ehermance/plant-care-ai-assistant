{% extends "base.html" %}

{% block title %}{{ reminder.title }} - Reminder - PlantCareAI{% endblock %}

{% block content %}
<section class="page-header">
  <h1 class="page-title">{{ reminder.title }}</h1>
  <p class="page-subtitle">
    {{ reminder.reminder_type|replace('_', ' ')|title }} reminder for
    <a href="{{ url_for('plants.view', plant_id=reminder.plant_id) }}">
      {{ reminder.plants.name }}{% if reminder.plants.nickname %} "{{ reminder.plants.nickname }}"{% endif %}
    </a>
  </p>
  <div class="page-actions">
    <a href="{{ url_for('reminders.edit', reminder_id=reminder.id) }}" class="btn btn-secondary">
      Edit
    </a>
  </div>
</section>

<div class="grid-two">
  <!-- Reminder Details -->
  <section class="card">
    <h2 class="section-title">Details</h2>

    <!-- Plant Info -->
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-color);">
      {% if reminder.plants.photo_url %}
      <img
        src="{{ reminder.plants.photo_url }}"
        alt="{{ reminder.plants.name }}"
        style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"
      />
      {% else %}
      <div style="width: 80px; height: 80px; background: var(--bg-secondary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
        ğŸª´
      </div>
      {% endif %}
      <div style="flex: 1;">
        <h3 style="margin: 0; font-size: 1.1rem;">
          <a href="{{ url_for('plants.view', plant_id=reminder.plant_id) }}">
            {{ reminder.plants.name }}
          </a>
        </h3>
        {% if reminder.plants.nickname %}
        <p style="margin: 0.25rem 0; color: var(--text-muted); font-size: 0.9rem;">"{{ reminder.plants.nickname }}"</p>
        {% endif %}
        {% if reminder.plants.location %}
        <p style="margin: 0.25rem 0; color: var(--text-muted); font-size: 0.9rem;">
          ğŸ“ {{ reminder.plants.location }}
        </p>
        {% endif %}
      </div>
    </div>

    <dl class="detail-list">
      <dt>Frequency</dt>
      <dd>{{ reminder.frequency|replace('_', ' ')|title }}
        {% if reminder.custom_interval_days %}
        ({{ reminder.custom_interval_days }} days)
        {% endif %}
      </dd>

      {% if reminder.next_due %}
      <dt>Next Due Date</dt>
      <dd>
        <strong>{{ reminder.next_due }}</strong>
        {% if reminder.weather_adjusted_due %}
        <br><span class="badge badge-weather">Weather adjusted: {{ reminder.weather_adjusted_due }}</span>
        {% endif %}
      </dd>
      {% endif %}

      {% if reminder.weather_adjustment_reason %}
      <dt>Weather Adjustment</dt>
      <dd>{{ reminder.weather_adjustment_reason }}</dd>
      {% endif %}

      {% if reminder.last_completed_at %}
      <dt>Last Completed</dt>
      <dd>{{ reminder.last_completed_at|replace('T', ' at ')|replace('+00:00', ' UTC') }}</dd>
      {% endif %}

      <dt>Status</dt>
      <dd>
        {% if reminder.is_active %}
        <span class="badge badge-success">Active</span>
        {% else %}
        <span class="badge badge-muted">Inactive</span>
        {% endif %}
      </dd>

      {% if reminder.notes %}
      <dt>Notes</dt>
      <dd>{{ reminder.notes }}</dd>
      {% endif %}
    </dl>
  </section>

  <!-- Actions -->
  <section class="card">
    <h2 class="section-title">Actions</h2>

    {% if reminder.is_active %}
    <div class="action-buttons-vertical">
      <!-- Mark Complete -->
      <form method="POST" action="{{ url_for('reminders.complete', reminder_id=reminder.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-primary btn-block">
          âœ“ Mark Complete
        </button>
      </form>

      <!-- Snooze Options -->
      <details class="action-details">
        <summary>ğŸ’¤ Snooze Reminder</summary>
        <div class="snooze-options">
          <form method="POST" action="{{ url_for('reminders.snooze', reminder_id=reminder.id) }}" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="days" value="1"/>
            <button type="submit" class="btn btn-small btn-secondary">1 day</button>
          </form>
          <form method="POST" action="{{ url_for('reminders.snooze', reminder_id=reminder.id) }}" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="days" value="2"/>
            <button type="submit" class="btn btn-small btn-secondary">2 days</button>
          </form>
          <form method="POST" action="{{ url_for('reminders.snooze', reminder_id=reminder.id) }}" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="days" value="3"/>
            <button type="submit" class="btn btn-small btn-secondary">3 days</button>
          </form>
        </div>
      </details>

      <!-- Weather Adjustment -->
      {% if reminder.reminder_type == 'watering' and not reminder.skip_weather_adjustment %}
      <form method="POST" action="{{ url_for('reminders.adjust_weather', reminder_id=reminder.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-secondary btn-block">
          ğŸŒ¤ï¸ Check Weather Adjustment
        </button>
      </form>

      {% if reminder.weather_adjusted_due %}
      <form method="POST" action="{{ url_for('reminders.clear_weather', reminder_id=reminder.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-secondary btn-block">
          Clear Weather Adjustment
        </button>
      </form>
      {% endif %}
      {% endif %}

      <!-- Delete -->
      <form method="POST" action="{{ url_for('reminders.delete', reminder_id=reminder.id) }}" onsubmit="return confirm('Are you sure you want to delete this reminder?');">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-outline btn-block btn-danger">
          Delete Reminder
        </button>
      </form>
    </div>
    {% else %}
    <p class="muted">This reminder has been archived and cannot be modified.</p>
    <div class="action-buttons-vertical" style="margin-top: 1rem;">
      <a href="{{ url_for('reminders.index') }}" class="btn btn-secondary btn-block">
        â† Back to Active Reminders
      </a>
      <a href="{{ url_for('reminders.history') }}" class="btn btn-secondary btn-block">
        View Reminder History
      </a>
    </div>
    {% endif %}

    <div class="muted small" style="margin-top: 1rem;">
      <p>Created: {{ reminder.created_at|replace('T', ' at ')|replace('+00:00', ' UTC') }}</p>
      <p>Updated: {{ reminder.updated_at|replace('T', ' at ')|replace('+00:00', ' UTC') }}</p>
    </div>
  </section>
</div>

{% endblock %}
