<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plant Care AI Assistant ‚Ä¢ EDH Dev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Ask for plant care help from an AI-powered assistant that gives practical tips based on your plants and local weather." />
  <meta name="theme-color" content="#0F766E" />
  <meta name="author" content="EDH Dev" />

  <meta property="og:title" content="Plant Care AI Assistant" />
  <meta property="og:description" content="Weather-aware plant care tips with an AI assist and graceful fallbacks." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="{{ url_for('static', filename='og-preview.png', _external=True) }}" />
  <meta property="og:url" content="{{ request.url_root }}" />

  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="alternate icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <meta name="robots" content="index, follow" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <div class="brand-hero" role="banner" aria-label="EDH Dev brand header with decorative tech-flora background">
    <div class="container hero-inner">
      <div class="brand-lockup">
        <a class="brand-chip" href="https://ehermance.github.io" target="_blank" rel="noopener">
          <span class="brand-initials" aria-hidden="true">EDH</span>
          <span class="visually-hidden">EDH Dev</span>
        </a>
        <div class="brand-text">
          <h1 class="app-title">Plant Care AI Assistant</h1>
          <p class="app-subtitle">Practical, weather-aware tips for healthy plants. Clean design, accessible by default.</p>
        </div>
      </div>

      {% set show_debug = (config.UI_DEBUG_LINKS or request.args.get('debug') == 'true') %}
      {% if show_debug %}
        <p class="small hero-links">
          <a class="muted-link" href="{{ url_for('web.healthz') }}" target="_blank" rel="noopener">Health check</a>
          &middot;
          <a class="muted-link" href="{{ url_for('web.debug_info') }}" target="_blank" rel="noopener">Debug info</a>
        </p>
      {% endif %}
    </div>
  </div>

  <div class="page-watermark" aria-hidden="true"></div>

  <div class="container">
    <main id="main">
      <section class="card" aria-labelledby="presets-title">
        <h2 id="presets-title" class="section-title">Recommended presets</h2>
        <div id="presets" aria-label="Recommended plant presets">
          <button type="button" class="preset-btn"
                  data-plant="Monstera deliciosa"
                  data-question="How often should I water?"
                  data-context="indoor_potted">
            Monstera ‚Äî watering (indoors)
          </button>
          <button type="button" class="preset-btn"
                  data-plant="Lavender"
                  data-question="How much sun does it need?"
                  data-context="outdoor_bed">
            Lavender ‚Äî light (garden bed)
          </button>
          <button type="button" class="preset-btn"
                  data-plant="Rosemary"
                  data-question="Best pot size and soil?"
                  data-context="outdoor_potted">
            Rosemary ‚Äî pot &amp; soil (outdoor pot)
          </button>
          <button type="button" class="preset-btn"
                  data-plant="Snake Plant"
                  data-question="Fertilizer schedule?"
                  data-context="indoor_potted">
            Snake Plant ‚Äî fertilizing (indoors)
          </button>
        </div>
      </section>

      <section class="grid-two" aria-labelledby="form-title" aria-busy="false">
        <div class="combined-loading-overlay" role="status" aria-live="polite" aria-atomic="true">
          <div class="spinner" aria-hidden="true"></div>
          <div>Thinking‚Ä¶</div>
        </div>

        <section class="card form-card" aria-labelledby="form-title">
          <h2 id="form-title" class="section-title">Ask for advice</h2>

          <form id="ask-form" class="form-grid" action="{{ url_for('web.ask') }}" method="post" novalidate>
            <div class="form-row form-row--two">
              <div>
                <label for="plant">Plant (optional)</label>
                <input id="plant" name="plant" type="text" autocomplete="off"
                       placeholder="e.g., Monstera deliciosa"
                       value="{{ (form_values and form_values.plant) or '' }}" />
              </div>
              <div>
                <label for="city">City or ZIP (optional)</label>
                <input id="city" name="city" type="text" autocomplete="off"
                      placeholder="e.g., Austin, TX or 73301"
                      value="{{ (form_values and form_values.city) or '' }}" />
              </div>
            </div>

            <div class="form-row">
              <div>
                <label for="care_context">Where is the plant?</label>
                <select id="care_context" name="care_context" aria-label="Where is the plant?">
                  <option value="indoor_potted"
                    {% if (form_values and form_values.care_context == 'indoor_potted') or (not form_values) %}selected{% endif %}>
                    Potted house plant (indoors)
                  </option>
                  <option value="outdoor_potted"
                    {% if form_values and form_values.care_context == 'outdoor_potted' %}selected{% endif %}>
                    Potted plant kept outdoors
                  </option>
                  <option value="outdoor_bed"
                    {% if form_values and form_values.care_context == 'outdoor_bed' %}selected{% endif %}>
                    Plant in an outdoor garden bed
                  </option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div>
                <label for="question">Question</label>
                <textarea id="question" name="question" rows="5"
                          placeholder="e.g., How often should I water?">{{ (form_values and form_values.question) or '' }}</textarea>
              </div>
            </div>

            <div class="actions">
              <button id="submit-btn" class="primary" type="submit">Ask</button>
              {% if form_values %}
                <span class="small muted">Last submitted:
                  <span class="mono">{{ form_values.care_context or 'indoor_potted' }}</span>
                </span>
              {% endif %}
            </div>
          </form>

          {% if ai_error and source == 'rule' %}
            <p class="small muted" role="status" aria-live="polite">
              AI unavailable ‚Äî showing rule-based tips.
            </p>
          {% endif %}
        </section>

        <section class="card answer-card" aria-labelledby="answer-title" role="region" tabindex="-1">
          <h2 id="answer-title" class="section-title">Answer</h2>
          {% if answer %}
            <p class="small muted">
              Generated by: <strong>{{ source == 'ai' and 'OpenAI' or 'Rule-based engine' }}</strong>
            </p>
            <pre class="prewrap">{{ answer }}</pre>
          {% else %}
            <p class="muted">Submit a question to see guidance here.</p>
          {% endif %}
        </section>
      </section>

      <section id="weather-section" data-units="f" aria-labelledby="weather-title">
        {% set today_date = now().strftime('%Y-%m-%d') %}
        <div class="weather-header">
          <h2 id="weather-title" class="section-title">
            {% if form_values and form_values.city %}
              Local Weather for {{ form_values.city }}
            {% elif weather and weather.city %}
              Local Weather for {{ weather.city }}
            {% else %}
              Local Weather
            {% endif %}
          </h2>

          {% if weather %}
          <form class="units-toggle" aria-label="Temperature units">
            <fieldset>
              <legend class="visually-hidden">Select units</legend>
              <label class="toggle-seg">
                <input type="radio" name="units" value="f" checked />
                <span aria-hidden="true">¬∞F</span>
                <span class="visually-hidden">Fahrenheit</span>
              </label>
              <label class="toggle-seg">
                <input type="radio" name="units" value="c" />
                <span aria-hidden="true">¬∞C</span>
                <span class="visually-hidden">Celsius</span>
              </label>
            </fieldset>
          </form>
          {% endif %}
        </div>

        {% if weather %}
          {% if hourly and hourly|length > 0 %}
          <div class="hourly-scroller" role="group" aria-label="Hourly forecast">
            {% for h in hourly %}
              <div class="hourly-chip">
                <div class="hourly-time">{{ h.time }}</div>
                <div class="hourly-emoji" aria-hidden="true">{{ h.emoji }}</div>
                <div class="hourly-temp">
                  <span class="only-f">{{ h.temp_f|round(0) }}¬∞F</span>
                  <span class="only-c">{{ h.temp_c|round(0) }}¬∞C</span>
                </div>
              </div>
            {% endfor %}
          </div>
          {% endif %}

          {% if alerts and alerts|length > 0 %}
          <div class="weather-alerts" role="region" aria-label="Weather alerts">
            {% for a in alerts %}
              <div class="alert-item">
                <strong class="alert-title">{{ a.title }}</strong>
                <span class="alert-desc">{{ a.desc }}</span>
              </div>
            {% endfor %}
          </div>
          {% endif %}

          <div class="forecast-grid">
            {% set today_forecast = None %}
            {% if forecast %}
              {% for f in forecast %}
                {% if f.date == today_date %}
                  {% set today_forecast = f %}
                {% endif %}
              {% endfor %}
            {% endif %}

            <div class="forecast-card today" aria-label="Today's weather summary">
              <div class="forecast-top">
                <div class="forecast-daywrap">
                  <div class="forecast-day">Today</div>
                  <span class="badge">Now</span>
                </div>
                <div class="forecast-emoji" aria-hidden="true">{{ weather.emoji or 'üå§Ô∏è' }}</div>
              </div>
              <div class="forecast-date">{{ today_date }}</div>

              <div class="forecast-temps">
                <span class="tlabel">Current</span>
                <span class="only-f tmax">{{ weather.temp_f | round(0) }}¬∞F</span>
                <span class="only-c tmax">{{ weather.temp_c | round(0) }}¬∞C</span>
              </div>

              {% if today_forecast %}
              <div class="forecast-temps">
                <span class="tlabel">High / Low</span>
                <span class="only-f tmax">{{ today_forecast.temp_max_f|round(0) }}¬∞F</span>
                <span class="only-c tmax">{{ today_forecast.temp_max_c|round(0) }}¬∞C</span>
                <span class="only-f tmin">/ {{ today_forecast.temp_min_f|round(0) }}¬∞F</span>
                <span class="only-c tmin">/ {{ today_forecast.temp_min_c|round(0) }}¬∞C</span>
              </div>
              {% endif %}

              <div class="forecast-desc">{{ weather.conditions|capitalize }}</div>
              <div class="forecast-extras small muted">
                Humidity: {{ weather.humidity }}% ‚Ä¢ Wind: {{ weather.wind_mph }} mph
              </div>
            </div>

            {% if forecast %}
              {% for f in forecast %}
              <div class="forecast-card" aria-label="Daily forecast">
                <div class="forecast-top">
                  <div class="forecast-day">{{ f.day }}</div>
                  <div class="forecast-emoji" aria-hidden="true">{{ f.emoji }}</div>
                </div>
                <div class="forecast-date">{{ f.date }}</div>
                <div class="forecast-temps">
                  <span class="tlabel">High / Low</span>
                  <span class="only-f tmax">{{ f.temp_max_f|round(0) }}¬∞F</span>
                  <span class="only-c tmax">{{ f.temp_max_c|round(0) }}¬∞C</span>
                  <span class="only-f tmin">/ {{ f.temp_min_f|round(0) }}¬∞F</span>
                  <span class="only-c tmin">/ {{ f.temp_min_c|round(0) }}¬∞C</span>
                </div>
                <div class="forecast-desc">{{ f.conditions|capitalize }}</div>
                <div class="forecast-extras small muted">
                  Humidity: {{ f.humidity }}% ‚Ä¢ Wind: {{ f.wind_mph }} mph
                </div>
              </div>
              {% endfor %}
            {% endif %}
          </div>
        {% elif form_values and form_values.city %}
          <p class="muted">No weather data available for that location.</p>
        {% else %}
          <p class="muted">Enter a city or ZIP to include weather tips in the answer.</p>
        {% endif %}
      </section>

      <section class="card" aria-labelledby="history-title">
        <div class="history-header">
          <h2 id="history-title" class="section-title">Recent Q&amp;A</h2>
          {% if has_history %}
            <a class="muted-link small clear-link" href="{{ url_for('web.clear_history') }}">Clear</a>
          {% endif %}
        </div>

        {% if has_history %}
          <ul class="history">
            {% for item in history %}
              <li>
                <div class="small muted mono">{{ item.ts }}</div>
                <div class="small">
                  <span class="mono">{{ item.source == 'ai' and 'AI' or 'Rule' }}</span>
                  {% if item.care_context %} ‚Ä¢ <span class="mono">{{ item.care_context }}</span>{% endif %}
                  {% if item.plant %} ‚Ä¢ <strong>Plant:</strong> {{ item.plant }}{% endif %}
                  {% if item.city %} ‚Ä¢ <strong>City/Zip:</strong> {{ item.city }}{% endif %}
                </div>
                <div class="small history-q"><strong>Q:</strong> {{ item.question }}</div>
                <details class="history-details">
                  <summary class="small muted-link">Show answer</summary>
                  <pre class="prewrap small history-answer">{{ item.answer }}</pre>
                </details>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="muted">No questions yet. Ask something above to populate the history.</p>
        {% endif %}
      </section>

    </main>
  </div>

  <footer class="site-footer" role="contentinfo">
    <p>&copy; <span id="copyright-year"></span> <a href="https://ehermance.github.io" rel="noopener">EDH Dev</a> ‚Äî Built with care</p>
  </footer>

  <script src="{{ url_for('static', filename='app.js') }}" defer></script>
</body>
</html>
