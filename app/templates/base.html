<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}PlantCareAI | Smart Plant Assistant for Weather-Aware Watering & Tips | EDH Dev{% endblock %}</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="{% block description %}PlantCareAI helps you keep every plant thriving with AI-powered reminders, weather-aware watering, and personalized care tips. Free to start, built by EDH Dev.{% endblock %}" />
  <meta name="keywords"
        content="plant care ai, plant care app, AI plant assistant, smart plant watering, plant reminder app, weather-based plant care, gardening app, houseplant tips">
  <meta name="author" content="EDH Dev" />
  <!-- Theme color adapts to light/dark mode -->
  <meta name="theme-color" content="#10b981" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)" />

  <!-- Robots (overridable per page) -->
  {% block robots %}<meta name="robots" content="index, follow" />{% endblock %}

  <!-- Security Meta Tags -->
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ request.base_url }}" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="PlantCareAI.app" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="{{ request.url }}" />
  <meta property="og:title" content="{% block og_title %}PlantCareAI üåø Your Smart Plant Assistant{% endblock %}" />
  <meta property="og:description" content="{% block og_description %}Personalized, weather-aware plant care powered by AI. No ads, just greener growth.{% endblock %}" />
  <meta property="og:image" content="{{ url_for('static', filename='images/logos/og-preview.png', _external=True) }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="PlantCareAI - Smart Plant Assistant" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{% block twitter_title %}PlantCareAI ‚Äì Smart Plant Assistant{% endblock %}" />
  <meta name="twitter:description" content="{% block twitter_description %}AI-powered plant care reminders and weather-aware guidance.{% endblock %}" />
  <meta name="twitter:image" content="{{ url_for('static', filename='images/logos/og-preview.png', _external=True) }}" />
  <meta name="twitter:image:alt" content="PlantCareAI - Smart Plant Assistant" />

   <!-- Icons & PWA -->
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/icons/favicon.svg') }}">
  <link rel="alternate icon" type="image/x-icon" href="{{ url_for('static', filename='images/icons/favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/icons/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/icons/favicon-16x16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/icons/apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://static.cloudflareinsights.com" crossorigin>

  <!-- Tailwind CSS (Horti-Futuristic Design System) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}" />

  <!-- Theme & timezone configuration for JavaScript (CSP-compliant) -->
  {% if is_authenticated and profile and profile.theme_preference %}
  <meta name="x-initial-theme" content="{{ profile.theme_preference }}">
  {% endif %}
  <meta name="x-user-timezone" content="{{ g.user_timezone or '' }}">

  <!-- Theme Manager (load early to prevent flash) -->
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>

  {% block extra_head %}{% endblock %}

  <!-- Organization Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "PlantCareAI",
    "url": "{{ request.url_root }}",
    "description": "AI-powered plant care assistant with weather-aware reminders and personalized tips."
  }
  </script>

  <!-- BreadcrumbList Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ request.url_root }}"
      }{% if request.path != '/' %},
      {
        "@type": "ListItem",
        "position": 2,
        "name": "{{ self.title() | replace(' | PlantCareAI', '') | replace(' - PlantCareAI', '') | replace(' ‚Äî PlantCareAI', '') | truncate(60) }}",
        "item": "{{ request.base_url }}"
      }{% endif %}
    ]
  }
  </script>

  <!-- Structured Data (JSON-LD) for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "PlantCareAI",
    "applicationCategory": "LifestyleApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "description": "AI-powered plant care assistant that provides personalized, weather-aware care reminders and tips for your plants.",
    "url": "{{ request.url_root }}",
    "author": {
      "@type": "Organization",
      "name": "EDH Dev"
    }
  }
  </script>

  <!-- Web Analytics (Cloudflare) -->
  {% if CF_BEACON_TOKEN %}
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "{{ CF_BEACON_TOKEN }}"}'></script>
  {% endif %}
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">
  <!-- Skip Link for Accessibility -->
  <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-emerald-600 focus:text-white focus:rounded-lg focus:shadow-lg">
    Skip to main content
  </a>

  <!-- Site Header -->
  <header class="relative cosmic-header border-b border-purple-700/30 sticky top-0 z-40 shadow-lg shadow-purple-900/50 overflow-visible backdrop-blur-sm" role="banner">
    <div class="container mx-auto px-1 py-7 overflow-visible">
      <div class="flex items-center justify-between gap-1 overflow-visible">
        <!-- Logo & Branding -->
        <div class="flex items-start gap-1 min-w-1">
          <a href="{{ url_for('web.index') }}" aria-label="PlantCareAI Home Logo" class="flex-shrink-0 hover:bg-purple-900/40 rounded-lg p-0.5 transition-all duration-200 group">
            <img src="{{ url_for('static', filename='images/illustrations/custom-leaf.svg') }}"
                 alt=""
                 aria-hidden="true"
                 class="h-12 w-12 logo-glow transition-all duration-200" />
            <span class="sr-only">Home</span>
          </a>
          <div class="min-w-0">
            <a href="{{ url_for('web.index') }}" aria-label="PlantCareAI Home Banner" class="block">
              <div class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-emerald-400 via-lime-300 to-amber-300 bg-clip-text text-transparent drop-shadow-lg">
                PlantCareAI <span aria-hidden="true" class="hidden sm:inline md:hidden lg:inline whitespace-nowrap">ü™¥ üå± üåµ</span>
              </div>
              <p class="text-xs sm:text-sm text-amber-200/80">{% block subtitle %}Your plants deserve to thrive. <span class="whitespace-nowrap">We'll show you how.</span>{% endblock %}</p>
            </a>
          </div>
        </div>

        {% if is_authenticated and profile and profile.get("is_admin", False) %}
        <!-- Admin Links -->
        <div class="flex justify-end text-right">
          <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint and request.endpoint.startswith('admin.') %} bg-amber-500/20 text-amber-300{% endif %}"
              href="{{ url_for('admin.index') }}"
              title="View your admin dashboard with key product metrics and user behavior insights"
              {% if request.endpoint and request.endpoint.startswith('admin.') %}aria-current="page"{% endif %}>Admin</a>
        </div>
        {% endif %}

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center gap-3 overflow-visible" aria-label="Main navigation">
          {% if is_authenticated %}
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint and request.endpoint.startswith('dashboard.') %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('dashboard.index') }}"
               title="View your plant dashboard with reminders and stats"
               {% if request.endpoint and request.endpoint.startswith('dashboard.') %}aria-current="page"{% endif %}>Dashboard</a>
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint == 'web.assistant' %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('web.assistant') }}"
               title="Get AI-powered plant care advice"
               {% if request.endpoint == 'web.assistant' %}aria-current="page"{% endif %}>Assistant</a>

            <!-- User Menu Dropdown -->
            <div class="relative">
              <button class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors flex items-center gap-1"
                      aria-expanded="false"
                      aria-haspopup="true"
                      id="user-menu-btn">
                <span aria-label="Account menu for {{ current_user.email }}">{{ current_user.email|truncate(20) }}</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 py-1 hidden z-50"
                   id="user-menu-dropdown"
                   role="menu"
                   aria-labelledby="user-menu-btn">
                <a href="{{ url_for('dashboard.account') }}"
                   role="menuitem"
                   class="block px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-emerald-600 dark:hover:text-emerald-400">
                  Account Settings
                </a>
                <a href="{{ url_for('auth.logout') }}"
                   role="menuitem"
                   class="block px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-emerald-600 dark:hover:text-emerald-400">
                  Log Out
                </a>
              </div>
            </div>
          {% else %}
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint == 'web.assistant' %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('web.assistant') }}"
               title="Get AI-powered plant care advice"
               {% if request.endpoint == 'web.assistant' %}aria-current="page"{% endif %}>Assistant</a>
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint and request.endpoint.startswith('guides.') %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('guides.index') }}"
               title="Browse plant care guides"
               {% if request.endpoint and request.endpoint.startswith('guides.') %}aria-current="page"{% endif %}>Guides</a>
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors{% if request.endpoint and request.endpoint.startswith('pricing.') %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('pricing.index') }}"
               title="View features and pricing plans"
               {% if request.endpoint and request.endpoint.startswith('pricing.') %}aria-current="page"{% endif %}>Features</a>
            <a class="px-4 py-2 rounded-lg font-medium text-slate-100 hover:text-amber-300 hover:bg-purple-900/30 transition-colors whitespace-nowrap{% if request.endpoint and request.endpoint.startswith('auth.login') %} bg-amber-500/20 text-amber-300{% endif %}"
               href="{{ url_for('auth.login') }}"
               title="Log in to your account"
               {% if request.endpoint and request.endpoint.startswith('auth.login') %}aria-current="page"{% endif %}>Log In</a>
            <a class="btn btn-primary whitespace-nowrap" href="{{ url_for('auth.signup') }}" title="Create a free account">Sign Up Free</a>
          {% endif %}
        </nav>
      </div>

      {% set show_debug = (config.UI_DEBUG_LINKS or request.args.get('debug') == 'true') %}
      {% if show_debug %}
      <!-- Debug Links -->
        <div class="mt-2 pt-2 border-t border-slate-200 dark:border-slate-700">
          <p class="text-xs text-slate-500 dark:text-slate-400">
            <a href="{{ url_for('web.healthz') }}" target="_blank" rel="noopener" class="hover:text-emerald-600 dark:hover:text-emerald-400">Health check</a>
            <span class="mx-2">¬∑</span>
            <a href="{{ url_for('web.debug_info') }}" target="_blank" rel="noopener" class="hover:text-emerald-600 dark:hover:text-emerald-400">Debug info</a>
          </p>
        </div>
      {% endif %}
    </div>
  </header>

  <!-- Flash Messages (WCAG-compliant alerts) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container mx-auto px-4 py-4">
        <div role="region" aria-label="Notifications" class="space-y-3">
          {% for category, message in messages %}
            <div class="flex items-center justify-between gap-4 p-4 rounded-lg border-2 {% if category == 'success' %}bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500 dark:border-emerald-600 text-emerald-800 dark:text-emerald-200{% elif category == 'error' %}bg-rose-50 dark:bg-rose-900/20 border-rose-500 dark:border-rose-600 text-rose-800 dark:text-rose-200{% elif category == 'warning' %}bg-amber-50 dark:bg-amber-900/20 border-amber-500 dark:border-amber-600 text-amber-800 dark:text-amber-200{% else %}bg-blue-50 dark:bg-blue-900/20 border-blue-500 dark:border-blue-600 text-blue-800 dark:text-blue-200{% endif %}"
                 role="alert"
                 aria-live="polite">
              <span class="flex-1">{{ message }}</span>
              <button class="flash-dismiss-btn flex-shrink-0 text-2xl leading-none hover:opacity-70 transition-opacity"
                      aria-label="Dismiss notification"
                      type="button">
                &times;
              </button>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endwith %}

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8 flex-1">
    <main id="main" role="main">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Mobile Bottom Navigation (app-like experience) -->
  <nav class="md:hidden fixed bottom-0 left-0 right-0 cosmic-header border-t border-purple-700/30 shadow-lg shadow-purple-900/50 z-40" aria-label="Mobile navigation">
    <div class="flex justify-around items-center h-16">
      {% if is_authenticated %}
        {# Authenticated users: Dashboard, Assistant, Account #}
        <a href="{{ url_for('dashboard.index') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint and request.endpoint.startswith('dashboard.') and request.endpoint != 'dashboard.account' %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-3xl" aria-hidden="true">üè°</span>
          <span>Dashboard</span>
        </a>
        <a href="{{ url_for('web.assistant') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint == 'web.assistant' %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-3xl" aria-hidden="true">üí°</span>
          <span>Assistant</span>
        </a>
        <a href="{{ url_for('dashboard.account') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint == 'dashboard.account' %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-3xl" aria-hidden="true">üë§</span>
          <span>Account</span>
        </a>
      {% else %}
        {# Unauthenticated users: Assistant, Guides, Sign Up #}
        <a href="{{ url_for('web.assistant') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint == 'web.assistant' %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-3xl" aria-hidden="true">üí°</span>
          <span>Assistant</span>
        </a>
        <a href="{{ url_for('guides.index') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint and request.endpoint.startswith('guides.') %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-2xl" aria-hidden="true">üìö</span>
          <span>Guides</span>
        </a>
        <a href="{{ url_for('auth.signup') }}"
           class="flex flex-col items-center justify-center flex-1 h-full gap-1 text-sm font-medium transition-colors {% if request.endpoint and request.endpoint.startswith('auth.signup') %}text-amber-300{% else %}text-slate-100 hover:text-amber-300{% endif %}">
          <span class="text-2xl" aria-hidden="true">üå±</span>
          <span>Sign Up</span>
        </a>
      {% endif %}
    </div>
  </nav>

  <!-- Footer -->
  <footer class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 mt-auto mb-16 md:mb-0" role="contentinfo">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col gap-4 text-sm text-slate-600 dark:text-slate-400">
        <!-- Row 1: Navigation -->
        <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-6">
          <!-- Footer Links -->
          <nav class="flex items-center gap-4" aria-label="Footer navigation">
            <a href="{{ url_for('guides.index') }}" class="text-emerald-600 dark:text-emerald-400 hover:underline">Plant Guides</a>
            <span aria-hidden="true">‚Ä¢</span>
            <a href="{{ url_for('pricing.index') }}" class="text-emerald-600 dark:text-emerald-400 hover:underline">Features</a>
            <span aria-hidden="true">‚Ä¢</span>
            <a href="{{ url_for('legal.terms') }}" class="text-emerald-600 dark:text-emerald-400 hover:underline">Terms</a>
            <span aria-hidden="true">‚Ä¢</span>
            <a href="{{ url_for('legal.privacy') }}" class="text-emerald-600 dark:text-emerald-400 hover:underline">Privacy</a>
          </nav>

          <!-- Social Links (muted to indicate secondary navigation) -->
          <div class="flex items-center gap-3">
            <a href="https://www.instagram.com/plantcareai/"
               target="_blank"
               rel="noopener noreferrer"
               class="text-slate-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors"
               aria-label="PlantCareAI on Instagram">
              Instagram
            </a>
            <span aria-hidden="true" class="text-slate-400 dark:text-slate-500">‚Ä¢</span>
            <a href="https://www.linkedin.com/company/plantcareai/"
               target="_blank"
               rel="noopener noreferrer"
               class="text-slate-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors"
               aria-label="PlantCareAI on LinkedIn">
              LinkedIn
            </a>
          </div>
        </div>

        <!-- Row 2: Branding -->
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
          <!-- Copyright -->
          <p class="text-center md:text-left">
            PlantCareAI.app
            <span aria-label="Copyright">&copy;</span>
            <span id="copyright-year"></span>
            by <a href="https://www.ehermance.com" target="_blank" rel="noopener noreferrer" class="text-emerald-600 dark:text-emerald-400 hover:underline">EDH Dev</a>
            <span class="hidden sm:inline mx-2">‚Äî</span>
            <span class="hidden sm:inline">Built with care</span>
          </p>

          <!-- Support Link -->
          <a href="https://buymeacoffee.com/edhdev"
             target="_blank"
             rel="noopener noreferrer"
             class="inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors font-medium"
             aria-label="Support this project - Buy me a coffee">
            <span aria-hidden="true">‚òï</span> Buy Me a Coffee
          </a>
        </div>
      </div>
    </div>
  </footer>

  {% block extra_scripts %}{% endblock %}

  <!-- Toast notification system -->
  <script src="{{ url_for('static', filename='js/toast.js') }}"></script>

  <!-- Timezone conversion for timestamps -->
  <script src="{{ url_for('static', filename='js/timezone.js') }}"></script>

  <!-- Mobile bottom navigation -->
  <script src="{{ url_for('static', filename='js/bottom-nav.js') }}"></script>

  <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html>
