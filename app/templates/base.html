<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Plant Care AI Assistant â€¢ EDH Dev{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="{% block description %}Ask for plant care help from an AI-powered assistant that gives practical tips based on your plants and local weather.{% endblock %}" />
  <meta name="author" content="EDH Dev" />
  <meta name="theme-color" content="#0F766E" />

  <!-- Security Meta Tags -->
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <!-- Canonical & Social -->
  <meta property="og:title" content="{% block og_title %}Plant Care AI Assistant{% endblock %}" />
  <meta property="og:description" content="{% block og_description %}Weather-aware plant care tips with an AI assist and graceful fallbacks.{% endblock %}" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="{{ url_for('static', filename='og-preview.png', _external=True) }}" />
  <meta property="og:url" content="{{ request.url_root }}" />
  <meta name="robots" content="index, follow" />

   <!-- Icons & PWA -->
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="alternate icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://static.cloudflareinsights.com" crossorigin>

  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />

  {% block extra_head %}{% endblock %}

  <!-- Web Analytics -->
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "{{ CF_BEACON_TOKEN }}"}'></script>
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Brand Header -->
  <div class="brand-hero" role="banner" aria-label="EDH Dev brand header">
    <div class="container hero-inner">
      <div class="brand-lockup">
        <a class="brand-chip" href="{{ url_for('web.index') }}" aria-label="Plant Care AI Home">
          <span class="brand-initials" aria-hidden="true">ðŸŒ¿</span>
          <span class="visually-hidden">Home</span>
        </a>
        <div class="brand-text">
          <h1 class="app-title">
            Plant Care AI Assistant <span aria-hidden="true" class="title-emojis">ðŸª´ ðŸŒ± ðŸŒµ</span>
          </h1>
          <p class="app-subtitle">{% block subtitle %}Your plants deserve to thrive. We'll show you how.{% endblock %}</p>
        </div>
      </div>

      <!-- Navigation (logged in vs logged out) -->
      <nav class="hero-nav" aria-label="Main navigation">
        {% if is_authenticated %}
          <a class="nav-link" href="{{ url_for('dashboard.index') }}">Dashboard</a>
          <a class="nav-link" href="{{ url_for('web.index') }}">Ask AI</a>
          <div class="user-menu">
            <button class="user-menu-btn" aria-expanded="false" aria-haspopup="true" id="user-menu-btn">
              <span aria-label="Account menu for {{ current_user.email }}">{{ current_user.email|truncate(20) }} â–¾</span>
            </button>
            <div class="user-menu-dropdown" hidden id="user-menu-dropdown" role="menu" aria-labelledby="user-menu-btn">
              <a href="{{ url_for('dashboard.account') }}" role="menuitem">Account Settings</a>
              <a href="{{ url_for('auth.logout') }}" role="menuitem">Log Out</a>
            </div>
          </div>
        {% else %}
          <a class="nav-link" href="{{ url_for('pricing.index') }}">Pricing</a>
          <a class="nav-link" href="{{ url_for('auth.login') }}">Log In</a>
          <a class="btn btn-primary" href="{{ url_for('auth.signup') }}">Sign Up Free</a>
        {% endif %}
      </nav>

      {% set show_debug = (config.UI_DEBUG_LINKS or request.args.get('debug') == 'true') %}
      {% if show_debug %}
        <p class="small hero-links">
          <a class="muted-link" href="{{ url_for('web.healthz') }}" target="_blank" rel="noopener">Health check</a>
          &middot;
          <a class="muted-link" href="{{ url_for('web.debug_info') }}" target="_blank" rel="noopener">Debug info</a>
        </p>
      {% endif %}
    </div>
  </div>

  <div class="page-watermark" aria-hidden="true"></div>

  <!-- Flash Messages (WCAG-compliant alerts) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container">
        <div class="flash-messages" role="region" aria-label="Notifications">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}" role="alert" aria-live="polite">
              <span class="flash-message">{{ message }}</span>
              <button class="flash-close" aria-label="Dismiss notification">&times;</button>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endwith %}

  <!-- Main Content -->
  <div class="container">
    <main id="main" role="main">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <p>&copy; <span id="copyright-year"></span> <a href="https://www.ehermance.com" rel="noopener">EDH Dev</a> â€” Built with care</p>
    <p class="footer-support">
      <a href="https://buymeacoffee.com/edhdev" target="_blank" rel="noopener" class="support-link">
        â˜• Buy Me a Coffee
      </a>
    </p>
  </footer>

  {% block extra_scripts %}{% endblock %}

  <script src="{{ url_for('static', filename='app.js') }}" defer></script>
</body>
</html>
