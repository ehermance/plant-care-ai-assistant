<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Plant Care AI | Smart Plant Assistant for Weather-Aware Watering & Tips | EDH Dev{% endblock %}</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="{% block description %}Plant Care AI helps you keep every plant thriving with AI-powered reminders, weather-aware watering, and personalized care tips. Free to start, built by EDH Dev.{% endblock %}" />
  <meta name="keywords"
        content="plant care app, AI plant assistant, smart plant watering, plant reminder app, weather-based plant care, gardening app, houseplant tips">
  <meta name="author" content="EDH Dev" />
  <meta name="theme-color" content="#0F766E" />

  <!-- Security Meta Tags -->
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ request.url }}" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Plant Care AI" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="{{ request.url }}" />
  <meta property="og:title" content="{% block og_title %}Plant Care AI 🌿 Your Smart Plant Assistant{% endblock %}" />
  <meta property="og:description" content="{% block og_description %}Personalized, weather-aware plant care powered by AI. No ads, just greener growth.{% endblock %}" />
  <meta property="og:image" content="{{ url_for('static', filename='og-preview.png', _external=True) }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Plant Care AI - Smart Plant Assistant" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{% block twitter_title %}Plant Care AI – Smart Plant Assistant{% endblock %}" />
  <meta name="twitter:description" content="{% block twitter_description %}AI-powered plant care reminders and weather-aware guidance.{% endblock %}" />
  <meta name="twitter:image" content="{{ url_for('static', filename='og-preview.png', _external=True) }}" />
  <meta name="twitter:image:alt" content="Plant Care AI - Smart Plant Assistant" />

  <!-- SEO -->
  <meta name="robots" content="index, follow" />

   <!-- Icons & PWA -->
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/icons/favicon.svg') }}">
  <link rel="alternate icon" type="image/x-icon" href="{{ url_for('static', filename='images/icons/favicon.ico') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/icons/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/icons/favicon-16x16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/icons/apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://static.cloudflareinsights.com" crossorigin>

  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />

  {% block extra_head %}{% endblock %}

  <!-- Structured Data (JSON-LD) for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Plant Care AI",
    "applicationCategory": "LifestyleApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "description": "AI-powered plant care assistant that provides personalized, weather-aware care reminders and tips for your plants.",
    "url": "{{ request.url_root }}",
    "author": {
      "@type": "Organization",
      "name": "EDH Dev"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "5.0",
      "ratingCount": "1"
    }
  }
  </script>

  <!-- Web Analytics (Cloudflare) -->
  {% if CF_BEACON_TOKEN %}
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "{{ CF_BEACON_TOKEN }}"}'></script>
  {% endif %}
</head>
<body>
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Site Header -->
  <header class="site-header" role="banner">
    <div class="container header-inner">
      <div class="logo-lockup">
        <a class="site-logo" href="{{ url_for('web.index') }}" aria-label="Plant Care AI Home">
          <span class="logo-icon" aria-hidden="true">🌿</span>
          <span class="visually-hidden">Home</span>
        </a>
        <div class="brand-text">
          <h1 class="site-title">
            Plant Care AI Assistant <span aria-hidden="true" class="title-decoration">🪴 🌱 🌵</span>
          </h1>
          <p class="site-tagline">{% block subtitle %}Your plants deserve to thrive. We'll show you how.{% endblock %}</p>
        </div>
      </div>

      <!-- Main Navigation -->
      <nav class="site-nav" aria-label="Main navigation">
        {% if is_authenticated %}
          <a class="nav-link{% if request.endpoint and request.endpoint.startswith('dashboard.') %} active{% endif %}"
             href="{{ url_for('dashboard.index') }}"
             {% if request.endpoint and request.endpoint.startswith('dashboard.') %}aria-current="page"{% endif %}>Dashboard</a>
          <a class="nav-link{% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %} active{% endif %}"
             href="{{ url_for('web.ask_ai') }}"
             {% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %}aria-current="page"{% endif %}>Care Assistant</a>
          <div class="user-menu">
            <button class="user-menu-btn" aria-expanded="false" aria-haspopup="true" id="user-menu-btn">
              <span aria-label="Account menu for {{ current_user.email }}">{{ current_user.email|truncate(20) }} ▾</span>
            </button>
            <div class="user-menu-dropdown" hidden id="user-menu-dropdown" role="menu" aria-labelledby="user-menu-btn">
              <a href="{{ url_for('dashboard.account') }}" role="menuitem">Account Settings</a>
              <a href="{{ url_for('auth.logout') }}" role="menuitem">Log Out</a>
            </div>
          </div>
        {% else %}
          <a class="nav-link{% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %} active{% endif %}"
             href="{{ url_for('web.ask_ai') }}"
             {% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %}aria-current="page"{% endif %}>Care Assistant</a>
          <a class="nav-link{% if request.endpoint and request.endpoint.startswith('pricing.') %} active{% endif %}"
             href="{{ url_for('pricing.index') }}"
             {% if request.endpoint and request.endpoint.startswith('pricing.') %}aria-current="page"{% endif %}>Features</a>
          <a class="nav-link{% if request.endpoint and request.endpoint.startswith('auth.login') %} active{% endif %}"
             href="{{ url_for('auth.login') }}"
             {% if request.endpoint and request.endpoint.startswith('auth.login') %}aria-current="page"{% endif %}>Log In</a>
          <a class="btn btn-primary" href="{{ url_for('auth.signup') }}">Sign Up Free</a>
        {% endif %}
      </nav>

      {% set show_debug = (config.UI_DEBUG_LINKS or request.args.get('debug') == 'true') %}
      {% if show_debug %}
        <p class="small nav-links">
          <a class="muted-link" href="{{ url_for('web.healthz') }}" target="_blank" rel="noopener">Health check</a>
          &middot;
          <a class="muted-link" href="{{ url_for('web.debug_info') }}" target="_blank" rel="noopener">Debug info</a>
        </p>
      {% endif %}
    </div>
  </header>

  <div class="page-watermark" aria-hidden="true"></div>

  <!-- Flash Messages (WCAG-compliant alerts) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container">
        <div class="flash-messages" role="region" aria-label="Notifications">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}" role="alert" aria-live="polite">
              <span class="flash-message">{{ message }}</span>
              <button class="flash-close" aria-label="Dismiss notification">&times;</button>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  {% endwith %}

  <!-- Main Content -->
  <div class="container">
    <main id="main" role="main">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Mobile Bottom Navigation (app-like experience) -->
  <nav class="bottom-nav" aria-label="Mobile navigation">
    {% if is_authenticated %}
      {# Authenticated users: Home, Care, Account #}
      <a href="{{ url_for('dashboard.index') }}" class="bottom-nav-item{% if request.endpoint and request.endpoint.startswith('dashboard.') %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">🏠</span>
        <span>Home</span>
      </a>
      <a href="{{ url_for('web.ask_ai') }}" class="bottom-nav-item{% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">🌿</span>
        <span>Care</span>
      </a>
      <a href="{{ url_for('dashboard.account') }}" class="bottom-nav-item{% if request.endpoint == 'dashboard.account' %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">👤</span>
        <span>Account</span>
      </a>
    {% else %}
      {# Unauthenticated users: Care, Features, Sign Up #}
      <a href="{{ url_for('web.ask_ai') }}" class="bottom-nav-item{% if request.endpoint == 'web.ask_ai' or request.endpoint == 'web.ask' %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">🌿</span>
        <span>Care</span>
      </a>
      <a href="{{ url_for('pricing.index') }}" class="bottom-nav-item{% if request.endpoint and request.endpoint.startswith('pricing.') %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">✨</span>
        <span>Features</span>
      </a>
      <a href="{{ url_for('auth.signup') }}" class="bottom-nav-item{% if request.endpoint and request.endpoint.startswith('auth.signup') %} active{% endif %}">
        <span class="bottom-nav-item-icon" aria-hidden="true">🌱</span>
        <span>Sign Up</span>
      </a>
    {% endif %}
  </nav>

  <!-- Footer -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-content">
      <p class="footer-copyright">
        <span aria-label="Copyright">&copy;</span> <span id="copyright-year"></span>
        <a href="https://www.ehermance.com" target="_blank" rel="noopener noreferrer" class="footer-link">EDH Dev</a>
        <span class="footer-divider" aria-hidden="true">—</span>
        <span class="footer-tagline">Built with care</span>
      </p>
      <nav class="footer-links" aria-label="Footer navigation">
        <a href="{{ url_for('legal.terms') }}" class="footer-link">Terms</a>
        <span class="footer-divider" aria-hidden="true">•</span>
        <a href="{{ url_for('legal.privacy') }}" class="footer-link">Privacy</a>
      </nav>
      <div class="footer-support">
        <a href="https://buymeacoffee.com/edhdev" target="_blank" rel="noopener noreferrer" class="support-link" aria-label="Support this project - Buy me a coffee">
          <span aria-hidden="true">☕</span> Buy Me a Coffee
        </a>
      </div>
    </div>
  </footer>

  {% block extra_scripts %}{% endblock %}

  <!-- Toast notification system -->
  <script src="{{ url_for('static', filename='js/toast.js') }}"></script>

  <!-- Mobile bottom navigation -->
  <script src="{{ url_for('static', filename='js/bottom-nav.js') }}"></script>

  <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</body>
</html>
