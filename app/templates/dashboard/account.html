{% extends "base.html" %}

{% block title %}Account Settings - Plant Care AI Assistant - PlantCareAI{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation (WCAG 2.4.8) -->
<nav aria-label="Breadcrumb" class="breadcrumb">
  <ol>
    <li><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
    <li aria-current="page">Account Settings</li>
  </ol>
</nav>

<!-- Page Header -->
<section class="dashboard-hero">
  <h2 class="dashboard-greeting">Account Settings</h2>
  <p class="dashboard-subtitle">Manage your profile, plan, and preferences.</p>
</section>

<!-- Account Information -->
<section class="card" aria-labelledby="account-info-title">
  <h3 id="account-info-title" class="section-title">Account Information</h3>

  <dl class="info-list">
    <div class="info-item">
      <dt>Email Address</dt>
      <dd>{{ profile.email if profile else current_user.email }}</dd>
    </div>

    <div class="info-item">
      <dt>Account ID</dt>
      <dd><code class="code-snippet">{{ current_user.id[:8] }}...</code></dd>
    </div>

    <div class="info-item">
      <dt>Member Since</dt>
      <dd>{{ current_user.created_at.strftime('%B %d, %Y') if current_user.created_at else 'Recently' }}</dd>
    </div>
  </dl>
</section>

<!-- Subscription & Plan -->
<section class="card" aria-labelledby="subscription-title">
  <h3 id="subscription-title" class="section-title">Subscription & Plan</h3>

  <div class="plan-status">
    <!-- Current: Free Forever -->
    <div class="plan-badge plan-badge-starter">
      <span class="badge-icon" aria-hidden="true">üå±</span>
      <div class="badge-content">
        <strong>Starter Plan</strong>
        <span class="badge-subtitle">Free forever, up to 20 plants</span>
      </div>
    </div>

    <div class="plan-details">
      <p>You're on the <strong>Starter</strong> plan (free forever).</p>
      <p class="small muted">All core features included. Premium options will be available in the future for power users who want advanced features like unlimited plants, AI image diagnosis, and export tools.</p>
    </div>
  </div>

  <!-- Plan Comparison -->
  <details class="plan-comparison">
    <summary>Compare plans</summary>
    <div class="comparison-table">
      <table>
        <caption class="visually-hidden">Plan feature comparison</caption>
        <thead>
          <tr>
            <th scope="col">Feature</th>
            <th scope="col">Starter</th>
            <th scope="col">Premium</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">Plants</th>
            <td>Up to 20</td>
            <td>Unlimited</td>
          </tr>
          <tr>
            <th scope="row">Care reminders</th>
            <td>‚úì</td>
            <td>‚úì</td>
          </tr>
          <tr>
            <th scope="row">AI assistant</th>
            <td>‚úì</td>
            <td>‚úì</td>
          </tr>
          <tr>
            <th scope="row">Photo uploads</th>
            <td>‚úì</td>
            <td>‚úì</td>
          </tr>
          <tr>
            <th scope="row">AI image diagnosis</th>
            <td>‚Äî</td>
            <td>Coming soon</td>
          </tr>
          <tr>
            <th scope="row">CSV/PDF export</th>
            <td>‚Äî</td>
            <td>‚úì</td>
          </tr>
          <tr>
            <th scope="row">Seasonal task generator</th>
            <td>‚Äî</td>
            <td>‚úì</td>
          </tr>
          <tr>
            <th scope="row">Priority support</th>
            <td>‚Äî</td>
            <td>‚úì</td>
          </tr>
        </tbody>
      </table>
    </div>
  </details>
</section>

<!-- Preferences -->
<section class="card" aria-labelledby="preferences-title">
  <h3 id="preferences-title" class="section-title">Preferences</h3>

  <form method="POST" action="{{ url_for('dashboard.account') }}" class="settings-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

    <div class="form-group">
      <label for="city" class="form-label">
        Location
        <span class="label-optional">(optional)</span>
      </label>
      <p id="city-help" class="form-help">
        Enter your city or ZIP code for weather-aware reminder adjustments.
        <br>
        <em>Example: Austin, TX or 78701</em>
      </p>
      <input
        type="text"
        id="city"
        name="city"
        class="form-input"
        value="{{ profile.city if profile and profile.city else '' }}"
        placeholder="Enter city or ZIP code"
        aria-describedby="city-help"
        maxlength="200"
      />
    </div>

    <div class="form-group">
      <label class="form-label">
        Theme Preference
      </label>
      <p id="theme-help" class="form-help">
        Choose your preferred color scheme. "Auto" follows your device's system setting.
      </p>

      <div class="radio-group" role="radiogroup" aria-describedby="theme-help">
        <label class="radio-label">
          <input
            type="radio"
            name="theme"
            value="light"
            class="radio-input"
            {% if profile and profile.theme_preference == 'light' %}checked{% endif %}
            data-theme-toggle
            data-theme-value="light"
          />
          <span class="radio-text">
            <span class="radio-icon" aria-hidden="true">‚òÄÔ∏è</span>
            <span>
              <strong>Light Mode</strong>
              <br>
              <span class="small muted">Bright, clean interface</span>
            </span>
          </span>
        </label>

        <label class="radio-label">
          <input
            type="radio"
            name="theme"
            value="dark"
            class="radio-input"
            {% if profile and profile.theme_preference == 'dark' %}checked{% endif %}
            data-theme-toggle
            data-theme-value="dark"
          />
          <span class="radio-text">
            <span class="radio-icon" aria-hidden="true">üåô</span>
            <span>
              <strong>Dark Mode</strong>
              <br>
              <span class="small muted">Easy on the eyes at night</span>
            </span>
          </span>
        </label>

        <label class="radio-label">
          <input
            type="radio"
            name="theme"
            value="auto"
            class="radio-input"
            {% if not profile or not profile.theme_preference or profile.theme_preference == 'auto' %}checked{% endif %}
            data-theme-toggle
            data-theme-value="auto"
          />
          <span class="radio-text">
            <span class="radio-icon" aria-hidden="true">üåì</span>
            <span>
              <strong>Auto (System)</strong>
              <br>
              <span class="small muted">Matches your device setting</span>
            </span>
          </span>
        </label>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        Save Preferences
      </button>
    </div>
  </form>

  <details class="settings-details" style="margin-top: 1.5rem;">
    <summary class="small muted">How is my location used?</summary>
    <p class="small muted" style="margin-top: 0.5rem;">
      Your location is used to provide weather-based watering adjustments for outdoor plants.
      We fetch current weather conditions from OpenWeather API to help optimize your plant care schedule.
      Your location is never shared with third parties and you can clear it at any time.
    </p>
  </details>
</section>

<!-- Danger Zone -->
<section class="card card-danger" aria-labelledby="danger-title">
  <h3 id="danger-title" class="section-title">Account Management</h3>

  <div class="danger-actions">
    <div class="danger-item">
      <div>
        <strong>Log Out</strong>
        <p class="small muted">Sign out of your account on this device.</p>
      </div>
      <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary btn-small">
        Log Out
      </a>
    </div>

    <div class="danger-item">
      <div>
        <strong>Delete Account</strong>
        <p class="small muted">Permanently delete your account and all data. This action cannot be undone.</p>
      </div>
      <button class="btn btn-outline btn-small" disabled>
        Delete Account (Coming Soon)
      </button>
    </div>
  </div>
</section>

<!-- Back to Dashboard -->
<div class="page-actions">
  <a href="{{ url_for('dashboard.index') }}" class="muted-link">
    ‚Üê Back to Dashboard
  </a>
</div>

{% endblock %}
