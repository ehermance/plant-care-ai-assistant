{% extends "base.html" %}

{% block title %}Dashboard - Plant Care AI Assistant - PlantCareAI{% endblock %}

{% block content %}
<!-- Welcome Section -->
<section class="dashboard-hero">
  <h2 class="dashboard-greeting">
    {% set hour = now().hour %}
    {% if hour < 12 %}Good morning{% elif hour < 18 %}Good afternoon{% else %}Good evening{% endif %}! ğŸŒ±
  </h2>
  <p class="dashboard-subtitle">
    {% if plant_count == 0 %}
      Welcome to your plant care dashboard. Let's add your first plant!
    {% elif plant_count == 1 %}
      You're caring for <strong>1 plant</strong>. Great start!
    {% else %}
      You're caring for <strong>{{ plant_count }} plants</strong>. Nice collection!
    {% endif %}
  </p>
</section>

<!-- Quick Stats -->
<div class="dashboard-stats">
  <a href="{{ url_for('plants.index') }}" class="stat-card stat-card-link">
    <div class="stat-icon" aria-hidden="true">ğŸª´</div>
    <div class="stat-content">
      <div class="stat-value">{{ plant_count }}</div>
      <div class="stat-label">Plants</div>
    </div>
  </a>

  <a href="{{ url_for('reminders.index') }}" class="stat-card stat-card-link {% if reminder_stats.due_today > 0 %}stat-card-alert{% endif %}">
    <div class="stat-icon" aria-hidden="true">ğŸ’§</div>
    <div class="stat-content">
      <div class="stat-value">{{ reminder_stats.due_today or 0 }}</div>
      <div class="stat-label">Due Today</div>
    </div>
  </a>

  <a href="{{ url_for('reminders.index') }}" class="stat-card stat-card-link">
    <div class="stat-icon" aria-hidden="true">ğŸ“…</div>
    <div class="stat-content">
      <div class="stat-value">{{ reminder_stats.upcoming_7_days or 0 }}</div>
      <div class="stat-label">Upcoming</div>
    </div>
  </a>

  <a href="{{ url_for('pricing.index') }}" class="stat-card stat-card-link">
    <div class="stat-icon" aria-hidden="true">ğŸŒ±</div>
    <div class="stat-content">
      <div class="stat-value">Starter</div>
      <div class="stat-label">Free Forever</div>
    </div>
  </a>
</div>

<!-- Quick Actions -->
<section class="card" aria-labelledby="actions-title">
  <h3 id="actions-title" class="section-title">Quick Actions</h3>

  <div class="action-buttons">
    <a href="/plants/add" class="btn btn-primary">
      Add Plant
    </a>
    <a href="{{ url_for('reminders.create') }}" class="btn btn-primary">
      + New Reminder
    </a>
    <a href="{{ url_for('web.ask_ai') }}" class="btn btn-secondary">
      Care Assistant
    </a>
    <a href="/plants" class="btn btn-secondary">
      View All Plants
    </a>
  </div>
</section>

<!-- Placeholder for Plants (will be implemented in Phase 4) -->
{% if plant_count > 0 %}
<section class="card" aria-labelledby="plants-title">
  <div class="section-header">
    <h3 id="plants-title" class="section-title">My Plants</h3>
    <a href="/plants" class="muted-link small">View all â†’</a>
  </div>
  <p class="muted">Your plants will appear here once you add them.</p>
</section>
{% else %}
<section class="card empty-state" aria-labelledby="empty-title">
  <img src="{{ url_for('static', filename='images/illustrations/seedling-empty-state.svg') }}"
       alt=""
       class="empty-state-illustration"
       aria-hidden="true">
  <h3 id="empty-title" class="empty-state-message">Ready to start your plant collection?</h3>
  <p class="empty-state-hint">Add your first plant to get personalized care reminders and track its growth.</p>
  <a href="/plants/add" class="btn btn-primary">Add Your First Plant</a>
</section>
{% endif %}

<!-- Care Reminders Due Today -->
{% if due_reminders %}
<section class="card" aria-labelledby="reminders-title">
  <div class="section-header">
    <h3 id="reminders-title" class="section-title">
      Care Reminders Due Today
      {% if reminder_stats.due_today > 0 %}
      <span class="badge badge-alert">{{ reminder_stats.due_today }}</span>
      {% endif %}
    </h3>
    <a href="{{ url_for('reminders.index') }}" class="muted-link small">View all â†’</a>
  </div>

  <div class="reminder-list">
    {% for reminder in due_reminders[:5] %}
    <div class="reminder-item reminder-due">
      <div class="reminder-icon">
        {% if reminder.reminder_type == 'watering' %}ğŸ’§
        {% elif reminder.reminder_type == 'fertilizing' %}ğŸŒ¿
        {% elif reminder.reminder_type == 'misting' %}ğŸ’¦
        {% elif reminder.reminder_type == 'pruning' %}âœ‚ï¸
        {% elif reminder.reminder_type == 'repotting' %}ğŸª´
        {% elif reminder.reminder_type == 'inspection' %}ğŸ”
        {% else %}ğŸ“{% endif %}
      </div>

      <div class="reminder-content">
        <h4 class="reminder-title">
          <a href="{{ url_for('reminders.view', reminder_id=reminder.id) }}">
            {{ reminder.title }}
          </a>
        </h4>
        <p class="reminder-meta small">
          <a href="{{ url_for('plants.view', plant_id=reminder.plant_id) }}" class="plant-link">
            {{ reminder.plant_name }}{% if reminder.plant_nickname %} "{{ reminder.plant_nickname }}"{% endif %}
          </a>
          {% if reminder.weather_adjustment_reason %}
          <span class="badge badge-weather" title="{{ reminder.weather_adjustment_reason }}">
            ğŸŒ¤ï¸ Adjusted
          </span>
          {% endif %}
        </p>
      </div>

      <div class="reminder-actions">
        <form method="POST" action="{{ url_for('reminders.complete', reminder_id=reminder.id) }}" style="display:inline;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <button type="submit" class="btn btn-small btn-primary" title="Mark complete">
            âœ“ Done
          </button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if reminder_stats.due_today > 5 %}
  <div class="muted small" style="text-align:center; margin-top:1rem;">
    <a href="{{ url_for('reminders.index') }}">+ {{ reminder_stats.due_today - 5 }} more reminders</a>
  </div>
  {% endif %}
</section>
{% elif reminder_stats.active_reminders > 0 %}
<section class="card" aria-labelledby="reminders-title">
  <div class="section-header">
    <h3 id="reminders-title" class="section-title">Care Reminders</h3>
    <a href="{{ url_for('reminders.index') }}" class="muted-link small">View all â†’</a>
  </div>
  <p class="muted">âœ… No reminders due today! You have {{ reminder_stats.upcoming_7_days }} upcoming in the next 7 days.</p>
</section>
{% else %}
<section class="card" aria-labelledby="reminders-title">
  <h3 id="reminders-title" class="section-title">Care Reminders</h3>
  <p class="muted">No reminders yet. <a href="{{ url_for('reminders.create') }}">Create your first reminder</a> to stay on top of plant care!</p>
</section>
{% endif %}

{% endblock %}